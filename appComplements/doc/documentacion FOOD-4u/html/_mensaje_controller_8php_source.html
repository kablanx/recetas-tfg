<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Food4uDoc: app/Http/Controllers/MensajeController.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="1_efuIMAmjzSpn9p7WalC6fA.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Food4uDoc
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_mensaje_controller_8php_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">MensajeController.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_mensaje_controller_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_app_1_1_http_1_1_controllers.html">App\Http\Controllers</a>;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> Illuminate\Http\Request;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> Illuminate\Support\Facades\DB;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">App\Helpers\JwtAuth</a>;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> App\Http\Controllers\Response;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_mensaje.html">App\Mensaje</a>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html">   11</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html">MensajeController</a> <span class="keyword">extends</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_controller.html">Controller</a></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;{</div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a52743b7ef5dc60978cdc9478ae143e8e">   13</a></span>&#160;    <span class="keyword">public</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a52743b7ef5dc60978cdc9478ae143e8e">$cont</a>=0;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a095c5d389db211932136b53f25f39685">   15</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a095c5d389db211932136b53f25f39685">__construct</a>()</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    {</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        $this-&gt;middleware(<span class="stringliteral">&#39;api.auth&#39;</span>, [<span class="stringliteral">&#39;except&#39;</span> =&gt; [<span class="stringliteral">&#39;getMensajesToUserByUser&#39;</span>, <span class="stringliteral">&#39;getMensajesUser&#39;</span><span class="comment">/* &#39;index&#39;, &#39;show&#39;, &#39;login&#39;, &#39;store&#39;*/</span>]]);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    }</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">   20</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">index</a>(Request $request)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        $mensajes = Mensaje::all();</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keywordflow">if</span> (!empty($mensajes)) {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            $data = array(</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                <span class="stringliteral">&#39;mensajes&#39;</span> =&gt; $mensajes</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            );</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            $data = array(</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;No existen mensajes&#39;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            );</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// Crear mensaje</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a9ef485163104597c12185b53cdacf638">   41</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a9ef485163104597c12185b53cdacf638">store</a>(Request $request)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        $json = $request-&gt;input(<span class="stringliteral">&#39;json&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        $params = json_decode($json);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        $params_array = json_decode($json, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="comment">// Comprobar token y si coincide id del token con el id pasado por json</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        $token = $request-&gt;header(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        $jwtAuth = <span class="keyword">new</span> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">JwtAuth</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// Devolver el objeto usuario identificado</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        $user = $jwtAuth-&gt;checkToken($token, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">if</span> (!empty($params_array)) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="comment">/* var_dump($user);die(); */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            <span class="keywordflow">if</span> ($user-&gt;sub != $params_array[<span class="stringliteral">&#39;id_usuario_e&#39;</span>]) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                $data = array(</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Error al recibir los datos.&#39;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                );</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                $mensaje = <span class="keyword">new</span> <a class="code" href="class_app_1_1_mensaje.html">Mensaje</a>();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                $mensaje-&gt;id_usuario_e = $params_array[<span class="stringliteral">&#39;id_usuario_e&#39;</span>];</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                $mensaje-&gt;id_usuario_r = $params_array[<span class="stringliteral">&#39;id_usuario_r&#39;</span>];</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                $mensaje-&gt;texto = $params_array[<span class="stringliteral">&#39;texto&#39;</span>];</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                $mensaje-&gt;save();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                $data = array(</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    <span class="stringliteral">&#39;mensaje&#39;</span> =&gt; $mensaje</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                );</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            $data = array(</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Error al enviar los datos.&#39;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            );</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Actualizar</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">   92</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">update</a>($id, Request $request)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        $json = $request-&gt;input(<span class="stringliteral">&#39;json&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        $params = json_decode($json);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        $params_array = json_decode($json, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> (!empty($params_array)) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            unset($params_array[<span class="stringliteral">&#39;id_usuario_e&#39;</span>]);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            unset($params_array[<span class="stringliteral">&#39;id_usuario_r&#39;</span>]);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            $mensaje = Mensaje::where(<span class="stringliteral">&#39;id&#39;</span>, $id)-&gt;update($params_array);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">if</span> ($mensaje == 0) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                $data = array(</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Mensaje no encontrado&#39;</span>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 400</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                $data = array(</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    <span class="stringliteral">&#39;mensaje&#39;</span> =&gt; $params_array,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 200</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                );</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            $data = array(</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Error al actualizar el mensaje&#39;</span>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 400</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            );</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">  126</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">destroy</a>($id, Request $request)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// Buscar mensaje</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        $mensaje = Mensaje::find($id);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (!empty($mensaje)) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            $token = $request-&gt;header(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            $jwtAuth = <span class="keyword">new</span> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">JwtAuth</a>();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            $userAuth = $jwtAuth-&gt;checkToken($token, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">if</span> ($mensaje-&gt;id_usuario_e == $userAuth-&gt;sub) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                $mensaje-&gt;delete();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                $data = array(</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    <span class="stringliteral">&#39;mensaje&#39;</span> =&gt; $mensaje</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                );</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                $data = array(</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Solo el creador del mensaje puede borrarlo.&#39;</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                );</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            $data = array(</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Mensaje no encontrado.&#39;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            );</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a578111c15e0582dd6eb0b8ef8b07c0c5">  158</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a578111c15e0582dd6eb0b8ef8b07c0c5">getMensajesToUserByUser</a>($id_e, $id_r)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        $mensajes = DB::table(<span class="stringliteral">&#39;mensajes&#39;</span>)-&gt;where([</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            [<span class="stringliteral">&#39;id_usuario_e&#39;</span>, $id_e],</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            [<span class="stringliteral">&#39;id_usuario_r&#39;</span>, $id_r]</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        ])</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            -&gt;orWhere([</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                [<span class="stringliteral">&#39;id_usuario_e&#39;</span>, $id_r],</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                [<span class="stringliteral">&#39;id_usuario_r&#39;</span>, $id_e]</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            ])</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            -&gt;orderBy(<span class="stringliteral">&#39;created_at&#39;</span>, <span class="stringliteral">&#39;desc&#39;</span>)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            -&gt;get();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        $data = array(</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="stringliteral">&#39;mensajes&#39;</span> =&gt; $mensajes</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        );</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a6ec571f7f61cade2940196066c10b121">  178</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a6ec571f7f61cade2940196066c10b121">getMensajesUser</a>($id)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        $mensajes = Mensaje::where(<span class="stringliteral">&#39;id_usuario_e&#39;</span>, $id)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            -&gt;orWhere(<span class="stringliteral">&#39;id_usuario_r&#39;</span>, $id)-&gt;distinct()-&gt;get([<span class="stringliteral">&#39;id_usuario_e&#39;</span>, <span class="stringliteral">&#39;id_usuario_r&#39;</span>])-&gt;load(<span class="stringliteral">&#39;userEnviado&#39;</span>, <span class="stringliteral">&#39;userRecibido&#39;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span> ($mensajes) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            $data = array(</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="stringliteral">&#39;mensajes&#39;</span> =&gt; $mensajes</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            );</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            $data = array(</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 400,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;Este usuario no tiene mensajes&#39;</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            );</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab994228ea1dbfbf83e8c777bd56819a5">  198</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab994228ea1dbfbf83e8c777bd56819a5">deleteMensajes</a>($id_user1, $id_user2){</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        $mensajes = DB::table(<span class="stringliteral">&#39;mensajes&#39;</span>)-&gt;where([</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            [<span class="stringliteral">&#39;id_usuario_e&#39;</span>, $id_user1],</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            [<span class="stringliteral">&#39;id_usuario_r&#39;</span>, $id_user2]</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        ])</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            -&gt;orWhere([</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                [<span class="stringliteral">&#39;id_usuario_e&#39;</span>, $id_user2],</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                [<span class="stringliteral">&#39;id_usuario_r&#39;</span>, $id_user1]</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            ])</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            -&gt;delete();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            $data = array(</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;200,</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="stringliteral">&#39;mensajes&#39;</span>=&gt;$mensajes</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            );</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html">App\Http\Controllers\MensajeController</a></div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00011">MensajeController.php:11</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a095c5d389db211932136b53f25f39685"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a095c5d389db211932136b53f25f39685">App\Http\Controllers\MensajeController\__construct</a></div><div class="ttdeci">__construct()</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00015">MensajeController.php:15</a></div></div>
<div class="ttc" id="a_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt_html_a6617cfb55e132d069e64bdfdbea31e1c"><div class="ttname"><a href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a></div><div class="ttdeci">you may not use this file except in compliance with the License You may obtain a copy of the License at software distributed under the License is distributed on an AS IS WITHOUT WARRANTIES OR CONDITIONS OF ANY either express or implied See the License for the specific language governing permissions and limitations under the License Apache License January AND DISTRIBUTION Definitions License shall mean the terms and conditions for use</div><div class="ttdef"><b>Definition:</b> <a href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt_source.html#l00027">LICENSE.txt:27</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_ab994228ea1dbfbf83e8c777bd56819a5"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab994228ea1dbfbf83e8c777bd56819a5">App\Http\Controllers\MensajeController\deleteMensajes</a></div><div class="ttdeci">deleteMensajes($id_user1, $id_user2)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00198">MensajeController.php:198</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a32ec91cf3f8f5949f04c98db16dd88a8"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">App\Http\Controllers\MensajeController\destroy</a></div><div class="ttdeci">destroy($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00126">MensajeController.php:126</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_ab567a949f50e20ea3d95ad062a17e3c3"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">App\Http\Controllers\MensajeController\index</a></div><div class="ttdeci">index(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00020">MensajeController.php:20</a></div></div>
<div class="ttc" id="anamespace_app_1_1_http_1_1_controllers_html"><div class="ttname"><a href="namespace_app_1_1_http_1_1_controllers.html">App\Http\Controllers</a></div><div class="ttdef"><b>Definition:</b> <a href="_comentario_controller_8php_source.html#l00003">ComentarioController.php:3</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a578111c15e0582dd6eb0b8ef8b07c0c5"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a578111c15e0582dd6eb0b8ef8b07c0c5">App\Http\Controllers\MensajeController\getMensajesToUserByUser</a></div><div class="ttdeci">getMensajesToUserByUser($id_e, $id_r)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00158">MensajeController.php:158</a></div></div>
<div class="ttc" id="aclass_app_1_1_helpers_1_1_jwt_auth_html"><div class="ttname"><a href="class_app_1_1_helpers_1_1_jwt_auth.html">App\Helpers\JwtAuth</a></div><div class="ttdef"><b>Definition:</b> <a href="_jwt_auth_8php_source.html#l00011">JwtAuth.php:11</a></div></div>
<div class="ttc" id="aclass_app_1_1_mensaje_html"><div class="ttname"><a href="class_app_1_1_mensaje.html">App\Mensaje</a></div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_8php_source.html#l00007">Mensaje.php:7</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_controller_html"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_controller.html">App\Http\Controllers\Controller</a></div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00010">Controller.php:10</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a9ef485163104597c12185b53cdacf638"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a9ef485163104597c12185b53cdacf638">App\Http\Controllers\MensajeController\store</a></div><div class="ttdeci">store(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00041">MensajeController.php:41</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a6ec571f7f61cade2940196066c10b121"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a6ec571f7f61cade2940196066c10b121">App\Http\Controllers\MensajeController\getMensajesUser</a></div><div class="ttdeci">getMensajesUser($id)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00178">MensajeController.php:178</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a52743b7ef5dc60978cdc9478ae143e8e"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a52743b7ef5dc60978cdc9478ae143e8e">App\Http\Controllers\MensajeController\$cont</a></div><div class="ttdeci">$cont</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00013">MensajeController.php:13</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_mensaje_controller_html_a5a9d70f8c9ecdc3ecaa113da8de5594b"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_mensaje_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">App\Http\Controllers\MensajeController\update</a></div><div class="ttdeci">update($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_mensaje_controller_8php_source.html#l00092">MensajeController.php:92</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d422163b96683743ed3963d4aac17747.html">app</a></li><li class="navelem"><a class="el" href="dir_0c4ee04d587063ecca91a7f35642b9f3.html">Http</a></li><li class="navelem"><a class="el" href="dir_27ba1f74dc73f44d4e9ca42f2dd266ec.html">Controllers</a></li><li class="navelem"><a class="el" href="_mensaje_controller_8php.html">MensajeController.php</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
