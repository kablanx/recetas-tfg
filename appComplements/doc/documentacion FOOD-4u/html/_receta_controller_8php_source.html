<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Food4uDoc: app/Http/Controllers/RecetaController.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="1_efuIMAmjzSpn9p7WalC6fA.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Food4uDoc
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_receta_controller_8php_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">RecetaController.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_receta_controller_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_app_1_1_http_1_1_controllers.html">App\Http\Controllers</a>;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_follower.html">App\Follower</a>;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> Illuminate\Http\Request;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> Illuminate\Http\Response;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">App\Helpers\JwtAuth</a>;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_receta.html">App\Receta</a>;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> <a class="code" href="class_app_1_1_user.html">App\User</a>;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> App\Http\Controllers\Storage;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<a class="code" href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a> Illuminate\Support\Facades\DB;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html">   14</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html">RecetaController</a> <span class="keyword">extends</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_controller.html">Controller</a></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="comment">// Usa siempre el middleware especificado excepto en los métodos indicados</span></div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a095c5d389db211932136b53f25f39685">   17</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a095c5d389db211932136b53f25f39685">__construct</a>(){</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        $this-&gt;middleware(<span class="stringliteral">&#39;api.auth&#39;</span>,[<span class="stringliteral">&#39;except&#39;</span> =&gt;[<span class="comment">/* &#39;index&#39;,*/</span> <span class="stringliteral">&#39;show&#39;</span>,  <span class="stringliteral">&#39;index&#39;</span>, <span class="stringliteral">&#39;getImage&#39;</span>, <span class="stringliteral">&#39;getInicio&#39;</span>]]);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    }</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// Listado de recetas</span></div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">   22</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">index</a>(Request $request)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="comment">/* $hash = $request-&gt;header(&#39;Authorization&#39;, null);</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">        $jwtAuth = new JwtAuth();</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">        $checkToken = $jwtAuth-&gt;checkToken($hash);</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">        if ($checkToken) {</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            <span class="comment">// -&gt;load(&#39;user&#39;) muestra los datos del usuario de cada receta</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            $recetas=Receta::orderByDesc(<span class="stringliteral">&#39;created_at&#39;</span>)-&gt;get();</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            <span class="keywordflow">return</span> response()-&gt;json(array(</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                <span class="stringliteral">&#39;code&#39;</span> =&gt; 200,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                <span class="stringliteral">&#39;recetas&#39;</span>=&gt;$recetas</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            ), 200);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="comment">/* } else {</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">            echo &quot;Index de recetas no autenticado&quot;;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">            die();</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">        } */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Mostrar receta por id</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a27ff257b020dbc77cdfb30f01f6734da">   44</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a27ff257b020dbc77cdfb30f01f6734da">show</a>($id, Request $request){</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="comment">// -&gt;load(&#39;user&#39;) muestra los datos del usuario que ha creado la receta</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        $receta=Receta::find($id)-&gt;load(<span class="stringliteral">&#39;user&#39;</span>,<span class="stringliteral">&#39;comentarios.user&#39;</span>, <span class="stringliteral">&#39;likes&#39;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="comment">/* var_dump($receta);die(); */</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">if</span>(is_object($receta)){</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            $data=array(</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt; 200,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                <span class="stringliteral">&#39;receta&#39;</span>=&gt;$receta,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <span class="stringliteral">&#39;likes&#39;</span>=&gt;$receta-&gt;likes-&gt;count()</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            );</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            $data=array(</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt; 400,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt; <span class="stringliteral">&#39;El registro no existe&#39;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            );</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Crear mensaje</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a9ef485163104597c12185b53cdacf638">   65</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a9ef485163104597c12185b53cdacf638">store</a>(Request $request)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        $json=$request-&gt;input(<span class="stringliteral">&#39;json&#39;</span>,<span class="keyword">null</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        $params=json_decode($json);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        $params_array = json_decode($json, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">// Archivos de imagenes y videos</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">/* $image1=$request-&gt;file(&#39;image1&#39;);</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">        $image2=$request-&gt;file(&#39;image2&#39;);</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">        $image3=$request-&gt;file(&#39;image3&#39;);</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">        $video1=$request-&gt;file(&#39;video1&#39;);</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">        $video2=$request-&gt;file(&#39;video2&#39;);</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">if</span>(!empty($params_array)){</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            $token = $request-&gt;header(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            $jwtAuth = <span class="keyword">new</span> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">JwtAuth</a>();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="comment">// Devolver el objeto usuario identificado</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            $user = $jwtAuth-&gt;checkToken($token, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            $validate = \Validator::make($params_array, [</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="stringliteral">&#39;nombre&#39;</span> =&gt; <span class="stringliteral">&#39;required&#39;</span>,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="comment">/* &#39;ingredientes&#39;=&gt;&#39;required&#39;,</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">                &#39;descripcion&#39; =&gt; &#39;required&#39;, */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="comment">/* &#39;image1&#39;=&gt;&#39;required|image|mimes:jpg,jpeg,png&#39; */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">/* &#39;image1&#39;=&gt;&#39;required&#39; */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            ]);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span>($validate-&gt;fails()){</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                $data=array(</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span>=&gt;400,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Error, faltan datos o la validación no es correcta.&#39;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                );</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="comment">/* $validate = \Validator::make($request-&gt;all(), [</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">                    &#39;image1&#39;=&gt;&#39;required|image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">                    &#39;image2&#39;=&gt;&#39;image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">                    &#39;image3&#39;=&gt;&#39;image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">                    &#39;video1&#39;=&gt;&#39;mimes:mp4,m4v,flv,mov&#39;,</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">                    &#39;video2&#39;=&gt;&#39;mimes:mp4,m4v,flv,mov&#39;</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">                ]);</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">                if ($validate-&gt;fails()) {</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">                    $data=array(</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">                        &#39;code&#39;=&gt;400,</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">                        &#39;status&#39;=&gt;&#39;error&#39;,</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">                        &#39;message&#39;=&gt;&#39;Error al validar las imágenes o vídeos.&#39;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">                    );</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">                }else{ */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        <span class="comment">/* var_dump($image1);die(); */</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        $receta = <span class="keyword">new</span> <a class="code" href="class_app_1_1_receta.html">Receta</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                        $receta-&gt;id_usuario=$user-&gt;sub;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        $receta-&gt;nombre=$params_array[<span class="stringliteral">&#39;nombre&#39;</span>];</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                        $receta-&gt;ingredientes=$params_array[<span class="stringliteral">&#39;ingredientes&#39;</span>];</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        $receta-&gt;descripcion=$params_array[<span class="stringliteral">&#39;descripcion&#39;</span>];</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        $receta-&gt;image1=$params_array[<span class="stringliteral">&#39;image1&#39;</span>];</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        <span class="keywordflow">if</span>($params_array[<span class="stringliteral">&#39;image2&#39;</span>]){</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                            $receta-&gt;image2=$params_array[<span class="stringliteral">&#39;image2&#39;</span>];</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keywordflow">if</span>($params_array[<span class="stringliteral">&#39;image3&#39;</span>]){</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                            $receta-&gt;image3=$params_array[<span class="stringliteral">&#39;image3&#39;</span>];</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                        }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        <span class="keywordflow">if</span>($params_array[<span class="stringliteral">&#39;video1&#39;</span>]){</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                            $receta-&gt;video1=$params_array[<span class="stringliteral">&#39;video1&#39;</span>];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                        <span class="keywordflow">if</span>($params_array[<span class="stringliteral">&#39;video2&#39;</span>]){</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                            $receta-&gt;video2=$params_array[<span class="stringliteral">&#39;video2&#39;</span>];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    <span class="comment">// Comprobar archivos de imagen y vídeo</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                    <span class="comment">/* if($image1){</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">                        $image_name=time().$image1-&gt;getClientOriginalName();</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">                        \Storage::disk(&#39;recetas&#39;)-&gt;put($image_name, \File::get($image1));</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">                        $params_array[&#39;image1&#39;]=$image_name;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">                        $receta-&gt;image1=$params_array[&#39;image1&#39;];</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">                    }</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">                    if($image2){</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">                        $image_name=time().$image2-&gt;getClientOriginalName();</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">                        \Storage::disk(&#39;recetas&#39;)-&gt;put($image_name, \File::get($image2));</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">                        $params_array[&#39;image2&#39;]=$image_name;</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">                        $receta-&gt;image2=$params_array[&#39;image2&#39;];</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                    }</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">                    if($image3){</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">                        $image_name=time().$image3-&gt;getClientOriginalName();</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">                        \Storage::disk(&#39;recetas&#39;)-&gt;put($image_name, \File::get($image3));</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">                        $params_array[&#39;image3&#39;]=$image_name;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">                        $receta-&gt;image3=$params_array[&#39;image3&#39;];</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">                    }</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">                    if($video1){</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">                        $video_name=time().$video1-&gt;getClientOriginalName();</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">                        \Storage::disk(&#39;recetas&#39;)-&gt;put($video_name, \File::get($video1));</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">                        $params_array[&#39;video1&#39;]=$video_name;</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">                        $receta-&gt;video1=$params_array[&#39;video1&#39;];</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">                    }</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">                    if($video2){</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">                        $video_name=time().$video2-&gt;getClientOriginalName();</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">                        \Storage::disk(&#39;recetas&#39;)-&gt;put($video_name, \File::get($video2));</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">                        $params_array[&#39;video2&#39;]=$video_name;</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">                        $receta-&gt;video2=$params_array[&#39;video2&#39;];</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">                    } */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <span class="comment">// $receta-&gt;image=$params_array[&#39;image&#39;];</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    $receta-&gt;save();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    $data=array(</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        <span class="stringliteral">&#39;code&#39;</span>=&gt;200,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                        <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        <span class="stringliteral">&#39;receta&#39;</span>=&gt;$receta</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    );</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <span class="comment">/* } */</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            $data=array(</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;400,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Error, faltan datos o la validación no es correcta.&#39;</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            );</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// Actualizar</span></div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">  192</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">update</a>($id, Request $request){</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">/* $hash = $request-&gt;header(&#39;Authorization&#39;, null);</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">        $jwtAuth = new JwtAuth();</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">        $checkToken = $jwtAuth-&gt;checkToken($hash);</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        $json=$request-&gt;input(<span class="stringliteral">&#39;json&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        $params=json_decode($json);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        $params_array=json_decode($json, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        $image1=$request-&gt;file(<span class="stringliteral">&#39;image1&#39;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        $image2=$request-&gt;file(<span class="stringliteral">&#39;image2&#39;</span>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        $image3=$request-&gt;file(<span class="stringliteral">&#39;image3&#39;</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        $video1=$request-&gt;file(<span class="stringliteral">&#39;video1&#39;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        $video2=$request-&gt;file(<span class="stringliteral">&#39;video2&#39;</span>);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> (!empty($params_array)) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            $validate = \Validator::make($params_array, [</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="stringliteral">&#39;nombre&#39;</span> =&gt; <span class="stringliteral">&#39;required&#39;</span>,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="comment">/* &#39;descripcion&#39; =&gt; &#39;required&#39;,</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">                &#39;ingredientes&#39; =&gt; &#39;required&#39; */</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            ]);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> ($validate-&gt;fails()) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                $data=array(</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span>=&gt;400,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Error, faltan datos o la validación no es correcta.&#39;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                );</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="comment">/* $validate = \Validator::make($request-&gt;all(), [</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">                    &#39;image1&#39;=&gt;&#39;required|image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">                    &#39;image2&#39;=&gt;&#39;image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">                    &#39;image3&#39;=&gt;&#39;image|mimes:jpg,jpeg,png&#39;,</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">                    &#39;video1&#39;=&gt;&#39;mimes:mp4,m4v,flv,mov&#39;,</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">                    &#39;video2&#39;=&gt;&#39;mimes:mp4,m4v,flv,mov&#39;</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">                ]);</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">                if ($validate-&gt;fails()) {</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">                    $data=array(</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">                        &#39;code&#39;=&gt;400,</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">                        &#39;status&#39;=&gt;&#39;error&#39;,</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">                        &#39;message&#39;=&gt;&#39;Error al validar las imágenes o vídeos.&#39;</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">                    );</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">                }else{ */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    $receta=Receta::find($id);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    <span class="comment">// Comprobar si hay imagenes o vídeos</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    <span class="keywordflow">if</span>($image1){</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        $image_name=time().$image1-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($image_name, \File::get($image1));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image1);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                        $params_array[<span class="stringliteral">&#39;image1&#39;</span>]=$image_name;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        $receta-&gt;image1=$params_array[<span class="stringliteral">&#39;image1&#39;</span>];</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    <span class="keywordflow">if</span>($image2){</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                        $image_name=time().$image2-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($image_name, \File::get($image2));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image2);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        $params_array[<span class="stringliteral">&#39;image2&#39;</span>]=$image_name;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                        $receta-&gt;image2=$params_array[<span class="stringliteral">&#39;image2&#39;</span>];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    <span class="keywordflow">if</span>($image3){</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        $image_name=time().$image3-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($image_name, \File::get($image3));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image3);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        $params_array[<span class="stringliteral">&#39;image3&#39;</span>]=$image_name;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        $receta-&gt;image3=$params_array[<span class="stringliteral">&#39;image3&#39;</span>];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                    <span class="keywordflow">if</span>($video1){</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        $video_name=time().$video1-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($video_name, \File::get($video1));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;video1);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        $params_array[<span class="stringliteral">&#39;video1&#39;</span>]=$video_name;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        $receta-&gt;video1=$params_array[<span class="stringliteral">&#39;video1&#39;</span>];</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    <span class="keywordflow">if</span>($video2){</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        $video_name=time().$video2-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($video_name, \File::get($video2));</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;video2);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        $params_array[<span class="stringliteral">&#39;video2&#39;</span>]=$video_name;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        $receta-&gt;video2=$params_array[<span class="stringliteral">&#39;video2&#39;</span>];</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    unset($params_array[<span class="stringliteral">&#39;id&#39;</span>]);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    unset($params_array[<span class="stringliteral">&#39;id_usuario&#39;</span>]);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    unset($params_array[<span class="stringliteral">&#39;created_at&#39;</span>]);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="comment">// Actualizar el registro</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    $receta=Receta::where(<span class="stringliteral">&#39;id&#39;</span>, $id)-&gt;update($params_array);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <span class="comment">// Obtener el registro actualizado</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    $receta=Receta::where(<span class="stringliteral">&#39;id&#39;</span>, $id)-&gt;get();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                $data=array(</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                        <span class="stringliteral">&#39;code&#39;</span>=&gt;200,</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                        <span class="stringliteral">&#39;changes&#39;</span>=&gt;$params_array,</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                        <span class="stringliteral">&#39;receta&#39;</span>=&gt;$receta</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    );</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">/* } else {</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">            // Devolver error</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">            $data = array(</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">                &#39;message&#39; =&gt; &#39;Error al enviar los datos&#39;,</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">                &#39;status&#39; =&gt; &#39;error&#39;,</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">                &#39;code&#39; =&gt; 400,</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">            );</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">        } */</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// Eliminar</span></div>
<div class="line"><a name="l00307"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">  307</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">destroy</a>($id, Request $request){</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">// Buscar receta</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        $receta=Receta::find($id);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="comment">/* var_dump($receta);die(); */</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span>(!empty($receta)){</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="comment">// Comprobar usuario autenticado</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            $token = $request-&gt;header(<span class="stringliteral">&#39;Authorization&#39;</span>, <span class="keyword">null</span>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            $jwtAuth = <span class="keyword">new</span> <a class="code" href="class_app_1_1_helpers_1_1_jwt_auth.html">JwtAuth</a>();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            $user = $jwtAuth-&gt;checkToken($token, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="comment">/* var_dump($token);die(); */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            $user=User::find($user-&gt;sub);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="comment">/* var_dump($user);die(); */</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment">/* var_dump($user-&gt;id);die(); */</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span>($user-&gt;id==$receta-&gt;id_usuario || $user-&gt;rol !=<span class="stringliteral">&quot;usuario&quot;</span>){</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image1);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image2);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;image3);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;video1);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;delete($receta-&gt;video2);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                $receta-&gt;delete();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                $data=array(</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span>=&gt;200,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    <span class="stringliteral">&#39;user&#39;</span>=&gt;$receta</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                $data=array(</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="stringliteral">&#39;code&#39;</span>=&gt;400,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;No puede borrar una receta sin ser administrador o creador de la receta.&#39;</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                );</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            $data=array(</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;400,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Receta no encontrada&#39;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data,$data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// Mostrar imagen o video</span></div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a050adbadfe609a01bc9dcb39c8043f4b">  351</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a050adbadfe609a01bc9dcb39c8043f4b">getImage</a>($filename){</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        $isset=\Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;exists($filename);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">if</span>($isset){</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            $file= \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;get($filename);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> Response($file, 200);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            $data=array(</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;La imagen no existe.&#39;</span>,</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;404</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            );</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="keywordflow">return</span> response()-&gt;json($data, $data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abc332ce722c8ad0e5e856fb246d68495">  366</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abc332ce722c8ad0e5e856fb246d68495">upload</a>(Request $request){</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">// Recoger datos de la petición</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        $image=$request-&gt;file(<span class="stringliteral">&#39;file0&#39;</span>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">// Validar imagen</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        $validate = \Validator::make($request-&gt;all(),[</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="stringliteral">&#39;file0&#39;</span>=&gt;<span class="stringliteral">&#39;required|image|mimes:jpg,jpeg,png&#39;</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        ]);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">// Guardar la imagen</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span>(!$image || $validate-&gt;fails()){</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            $data=array(</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Error al subir la imagen.&#39;</span>,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;400</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            );</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            $image_name=time().$image-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($image_name, \File::get($image));</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            $data=array(</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="stringliteral">&#39;image&#39;</span>=&gt;$image_name,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;200</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            );</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">// Devolver los datos en texto plano</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">return</span> response($data, $data[<span class="stringliteral">&#39;code&#39;</span>])-&gt;header(<span class="stringliteral">&#39;Content-Type&#39;</span>, <span class="stringliteral">&#39;text/plain&#39;</span>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abeee8e81361d7acd476431ef8117e05e">  395</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abeee8e81361d7acd476431ef8117e05e">uploadVideo</a>(Request $request){</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">// Recoger datos de la petición</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        $video=$request-&gt;file(<span class="stringliteral">&#39;file0&#39;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">// Validar imagen</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        $validate = \Validator::make($request-&gt;all(),[</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="stringliteral">&#39;file0&#39;</span>=&gt;<span class="stringliteral">&#39;required|mimes:mp4,mkv,vk&#39;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        ]);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment">// Guardar la imagen</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">if</span>(!$video || $validate-&gt;fails()){</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            $data=array(</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;error&#39;</span>,</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="stringliteral">&#39;message&#39;</span>=&gt;<span class="stringliteral">&#39;Error al subir la imagen.&#39;</span>,</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;400</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            );</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            $video_name=time().$video-&gt;getClientOriginalName();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            \Storage::disk(<span class="stringliteral">&#39;recetas&#39;</span>)-&gt;put($video_name, \File::get($video));</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            $data=array(</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="stringliteral">&#39;video&#39;</span>=&gt;$video_name,</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="stringliteral">&#39;code&#39;</span>=&gt;200</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            );</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">// Devolver los datos en texto plano</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">return</span> response($data, $data[<span class="stringliteral">&#39;code&#39;</span>])-&gt;header(<span class="stringliteral">&#39;Content-Type&#39;</span>, <span class="stringliteral">&#39;text/plain&#39;</span>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a0f4109c63471278abd7aeed544c18753">  425</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a0f4109c63471278abd7aeed544c18753">getInicio</a>($id, Request $request){</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;       <span class="comment">/*  $recetas=Receta::select(&#39;*&#39;)-&gt;join(&#39;followers&#39;, &#39;id_&#39;)</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">        -&gt;where(&#39;recetas.id_usuario&#39;,&#39;=&#39;,$id)</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">        -&gt;orWhere(&#39;recetas.id_usuario&#39;,&#39;=&#39;,&#39;followers.id_followed&#39;)</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">        -&gt;get(); */</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">/*  */</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="comment">/* $recetas=DB::table(&#39;recetas&#39;)</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">        -&gt;join(&#39;followers&#39;, &#39;recetas.id_usuario&#39;,&#39;=&#39;,&#39;followers.id_followed&#39;)</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">        -&gt;select(&#39;recetas.*&#39;)</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">        -&gt;where(</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">            [&#39;followers.id_follower&#39;, &#39;=&#39;, $id],</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">            [&#39;followers.followed&#39;, &#39;=&#39;, 1],</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">            [&#39;followers.id_followed&#39;,&#39;=&#39;,&#39;recetas.id_usuario&#39;]</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">            )</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">        -&gt;orWhere(</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">            [&#39;recetas.id_usuario&#39;,&#39;=&#39;,$id]</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">            )</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">        -&gt;distinct()</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">        -&gt;get(); */</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="comment">/* $recetas=Receta::all()-&gt;whereHas(&#39;user.seguidores&#39;,function($q){</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">            $q-&gt;where(&#39;user.seguidores&#39;, &#39;like&#39;, &#39;foo%&#39;);</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">        }); */</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">/* $recetas=Receta::all()-&gt;load(&#39;user.seguidores&#39;)-&gt;sortByDesc(&#39;created_at&#39;) */</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">/* -&gt;where(&#39;user.seguidores.id&#39;,&#39;=&#39;, 4) */</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        $recetas=DB::select(<span class="stringliteral">&quot;SELECT * FROM recetas WHERE recetas.id_usuario=$id OR recetas.id_usuario IN (SELECT followers.id_followed FROM followers WHERE followers.id_follower=$id AND followers.followed=1)&quot;</span> );</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="comment">//$recetas=Receta::addSelect([&#39;nombre&#39; =&gt;Follower::select(&#39;id_follower&#39;, &#39;id_followed&#39;, &#39;followed&#39;)</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="comment">//-&gt;whereColumn(&#39;id_follower&#39;, &#39;recetas.id_usuario&#39;)])-&gt;get();</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="comment">// Le he mandado un mensaje a alfonso sobre este cacho de código</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="comment">// explicandole por qué no funciona como debería</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="comment">/* $recetas=DB::table(&#39;recetas&#39;)</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">        -&gt;join(&#39;followers&#39;, &#39;recetas.id_usuario&#39;,&#39;=&#39;,&#39;followers.id_followed&#39;)</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">        -&gt;select(&#39;recetas.*&#39;)</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">        -&gt;where(&#39;recetas.id_usuario&#39;,&#39;=&#39;,$id)</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">        -&gt;orWhere(&#39;followers.id_follower&#39;,&#39;=&#39;, $id,</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">        &#39;AND&#39;, &#39;followers.followed&#39;,&#39;=&#39;,1)</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">        -&gt;distinct()</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">        -&gt;get(); */</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">//var_dump($recetas);die();</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        $data=array(</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="charliteral">&#39;n&#39;</span>=&gt;count($recetas),</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="stringliteral">&#39;code&#39;</span>=&gt;200,</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="stringliteral">&#39;recetas&#39;</span>=&gt;$recetas</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        );</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data,$data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ae51267ad6d047cb07eb73ffd6e98137f">  481</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ae51267ad6d047cb07eb73ffd6e98137f">buscar</a>($name){</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        $recetas=Receta::where(<span class="stringliteral">&#39;nombre&#39;</span>, <span class="stringliteral">&#39;LIKE&#39;</span>, <span class="stringliteral">&quot;%{$name}%&quot;</span>)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        -&gt;orWhere(<span class="stringliteral">&#39;ingredientes&#39;</span>, <span class="stringliteral">&#39;LIKE&#39;</span>, <span class="stringliteral">&quot;%{$name}%&quot;</span>)-&gt;get();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        $data=array(</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;success&#39;</span>,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="stringliteral">&#39;recetas&#39;</span>=&gt;$recetas,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="stringliteral">&#39;code&#39;</span>=&gt;200</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        );</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">return</span> response()-&gt;json($data,$data[<span class="stringliteral">&#39;code&#39;</span>]);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a0f4109c63471278abd7aeed544c18753"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a0f4109c63471278abd7aeed544c18753">App\Http\Controllers\RecetaController\getInicio</a></div><div class="ttdeci">getInicio($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00425">RecetaController.php:425</a></div></div>
<div class="ttc" id="a_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt_html_a6617cfb55e132d069e64bdfdbea31e1c"><div class="ttname"><a href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt.html#a6617cfb55e132d069e64bdfdbea31e1c">use</a></div><div class="ttdeci">you may not use this file except in compliance with the License You may obtain a copy of the License at software distributed under the License is distributed on an AS IS WITHOUT WARRANTIES OR CONDITIONS OF ANY either express or implied See the License for the specific language governing permissions and limitations under the License Apache License January AND DISTRIBUTION Definitions License shall mean the terms and conditions for use</div><div class="ttdef"><b>Definition:</b> <a href="_0dwebassemblyjs_2leb128_2_l_i_c_e_n_s_e_8txt_source.html#l00027">LICENSE.txt:27</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a27ff257b020dbc77cdfb30f01f6734da"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a27ff257b020dbc77cdfb30f01f6734da">App\Http\Controllers\RecetaController\show</a></div><div class="ttdeci">show($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00044">RecetaController.php:44</a></div></div>
<div class="ttc" id="anamespace_app_1_1_http_1_1_controllers_html"><div class="ttname"><a href="namespace_app_1_1_http_1_1_controllers.html">App\Http\Controllers</a></div><div class="ttdef"><b>Definition:</b> <a href="_comentario_controller_8php_source.html#l00003">ComentarioController.php:3</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a5a9d70f8c9ecdc3ecaa113da8de5594b"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a5a9d70f8c9ecdc3ecaa113da8de5594b">App\Http\Controllers\RecetaController\update</a></div><div class="ttdeci">update($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00192">RecetaController.php:192</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_ab567a949f50e20ea3d95ad062a17e3c3"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ab567a949f50e20ea3d95ad062a17e3c3">App\Http\Controllers\RecetaController\index</a></div><div class="ttdeci">index(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00022">RecetaController.php:22</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a32ec91cf3f8f5949f04c98db16dd88a8"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a32ec91cf3f8f5949f04c98db16dd88a8">App\Http\Controllers\RecetaController\destroy</a></div><div class="ttdeci">destroy($id, Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00307">RecetaController.php:307</a></div></div>
<div class="ttc" id="aclass_app_1_1_helpers_1_1_jwt_auth_html"><div class="ttname"><a href="class_app_1_1_helpers_1_1_jwt_auth.html">App\Helpers\JwtAuth</a></div><div class="ttdef"><b>Definition:</b> <a href="_jwt_auth_8php_source.html#l00011">JwtAuth.php:11</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_controller_html"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_controller.html">App\Http\Controllers\Controller</a></div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00010">Controller.php:10</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_abeee8e81361d7acd476431ef8117e05e"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abeee8e81361d7acd476431ef8117e05e">App\Http\Controllers\RecetaController\uploadVideo</a></div><div class="ttdeci">uploadVideo(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00395">RecetaController.php:395</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a9ef485163104597c12185b53cdacf638"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a9ef485163104597c12185b53cdacf638">App\Http\Controllers\RecetaController\store</a></div><div class="ttdeci">store(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00065">RecetaController.php:65</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html">App\Http\Controllers\RecetaController</a></div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00014">RecetaController.php:14</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_abc332ce722c8ad0e5e856fb246d68495"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#abc332ce722c8ad0e5e856fb246d68495">App\Http\Controllers\RecetaController\upload</a></div><div class="ttdeci">upload(Request $request)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00366">RecetaController.php:366</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a095c5d389db211932136b53f25f39685"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a095c5d389db211932136b53f25f39685">App\Http\Controllers\RecetaController\__construct</a></div><div class="ttdeci">__construct()</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00017">RecetaController.php:17</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_ae51267ad6d047cb07eb73ffd6e98137f"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#ae51267ad6d047cb07eb73ffd6e98137f">App\Http\Controllers\RecetaController\buscar</a></div><div class="ttdeci">buscar($name)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00481">RecetaController.php:481</a></div></div>
<div class="ttc" id="aclass_app_1_1_user_html"><div class="ttname"><a href="class_app_1_1_user.html">App\User</a></div><div class="ttdef"><b>Definition:</b> <a href="_user_8php_source.html#l00009">User.php:9</a></div></div>
<div class="ttc" id="aclass_app_1_1_receta_html"><div class="ttname"><a href="class_app_1_1_receta.html">App\Receta</a></div><div class="ttdef"><b>Definition:</b> <a href="_receta_8php_source.html#l00007">Receta.php:7</a></div></div>
<div class="ttc" id="aclass_app_1_1_follower_html"><div class="ttname"><a href="class_app_1_1_follower.html">App\Follower</a></div><div class="ttdef"><b>Definition:</b> <a href="_follower_8php_source.html#l00007">Follower.php:7</a></div></div>
<div class="ttc" id="aclass_app_1_1_http_1_1_controllers_1_1_receta_controller_html_a050adbadfe609a01bc9dcb39c8043f4b"><div class="ttname"><a href="class_app_1_1_http_1_1_controllers_1_1_receta_controller.html#a050adbadfe609a01bc9dcb39c8043f4b">App\Http\Controllers\RecetaController\getImage</a></div><div class="ttdeci">getImage($filename)</div><div class="ttdef"><b>Definition:</b> <a href="_receta_controller_8php_source.html#l00351">RecetaController.php:351</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d422163b96683743ed3963d4aac17747.html">app</a></li><li class="navelem"><a class="el" href="dir_0c4ee04d587063ecca91a7f35642b9f3.html">Http</a></li><li class="navelem"><a class="el" href="dir_27ba1f74dc73f44d4e9ca42f2dd266ec.html">Controllers</a></li><li class="navelem"><a class="el" href="_receta_controller_8php.html">RecetaController.php</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
